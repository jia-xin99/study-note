# 1.  MySQL基础篇

## 01 MySQL

### （1）概念

- 数据库DB：存储数据的仓库
- 数据库管理系统DBMS：操作和管理数据库的软件
- SQL：结构化查询语言，操作关系型数据库的编程语言，定义了一套操作 关系型数据库统一标准
- 关系型数据库RDBMS：建立在关系模型基础上，由多张相互连接的二维表组成的数据库。关系模型表明了数据库中所存储的数据之间的联系（一对一、一对多、多对多）

### （2）操作

MYSQL启动和关闭：

```sh
net start mysql80
net stop mysql80
```

MYSQL连接数据库：

```sh
#[ ]可选（默认127.0.0.1:3306），用户名：root，p：用户密码
mysql [-h IP] [-P 端口号] -u root -p
```

## 02 SQL

| 分类 |                       说明                       |
| :--: | :----------------------------------------------: |
| DDL  | 数据定义语言，定义数据库对象（数据库，表，字段） |
| DML  |     数据操作语言，对数据库表中数据进行增删改     |
| DQL  |            数据查询语言，查询表中记录            |
| DCL  | 数据控制语言，创建数据库用户、控制数据库访问权限 |

### （1）通用语法

- SQL语句可以单行或多行书写，以分号结尾
- SQL语句可以使用空格/缩进来增强语句的可读性
- MySQL数据库的SQL语句不区分大小写，关键字建议使用大写
- 注释：
  - 单行注释：-- 注释内容 或 # 注释内容
  - 多行注释：/* 注释内容 */

### （2）DDL

#### 【1】数据库操作

- 查询所有数据库

```sql
SHOW DATABASES;
```

- 查询当前数据库

```sql
SELECT DATABASE( );
```

- 创建数据库

```sql
# 同一个数据库服务器中，不能创建两个同名数据库，否则报错
CREATE DATABASE [ IF NOT EXISTS ] 数据库名 [ DEFAULT CHARSET 字符集 ] [ COLLATE 排序规则 ] ;
#eg1:
CREATE DATABASE IF NOT EXISTS study1;
#eg2: 指定字符集
CREATE DATABASE IF NOT EXISTS  study DEFAULT CHARSET utf8mb4;
```

- 删除数据库

```sql
# 删除不存在的数据库会报错，加if exists先判断是否存再决定是否执行删除
DROP DATABASE [ IF EXISTS ] 数据库名;
```

- 切换数据库

```sql
USE 数据库名;
```

#### 【2】表操作

##### 1）查询创建

- 查询当前数据库所有表

```sql
# 前提：进入某个数据库，use xx;
SHOW TABLES;
```

- 查看指定表结构

```sql
DESC 表名;
```

- 查询指定表的建表语句

```sql
SHOW CREATE TABLE 表名;
```

- 创建表结构

```sql
CREATE TABLE [IF NOT EXISTS] 表名(
		字段1 字段1类型 [COMMENT 字段1注释],
   	 	字段2 字段2类型 [COMMENT 字段2注释],
    	...
    字段n 字段n类型 [COMMENT 字段n注释]
) [COMMENT 表注释];
```

##### 2）数据类型

- 数值类型：TINYINT，INT，FLOAT，DOUBLE，DECIMAL等

- 字符串类型：CHAR，VARCHAR，LONGTEXT,BLOB等
  - CHAR与VARCHAR：都需要指定长度，CHAR是定长字符串,效率较高；VARCHAR是变长字符串

- 日期时间类型：DATE，TIME，YEAR，DATETIME，TIMESTAMP

```sql
CREATE TABLE IF NOT EXISTS emp(
	id INT COMMENT '编号',
    workno VARCHAR(10) COMMENT '员工工号',
    name VARCHAR(10) COMMENT '员工姓名',
    gender CHAR(1) COMMENT '性别',
    age TINYINT UNSIGNED COMMENT '年龄',
    idcard CHAR(18) COMMENT '身份证',
    entrydate DATA COMMENT '入职时间'
) COMMENT '员工表';
```

##### 3）修改

- 添加字段

```sql
ALTER TABLE 表名 ADD 字段名 类型(长度) [COMMENT 注释] [约束];
# eg:
alter table emp add nickname varchar(20);
```

- 修改数据类型

```sql
ALTER TABLE 表名 MODIFY 字段名 新数据类型(长度);
```

- 修改字段名和数据类型

```sql
ALTER TABLE 表名 CHANGE 字段名 新字段名 类型(长度) [COMMENT 注释] [约束];
# eg:
alter table emp change nickname username varchar(30) comment '昵称';
```

- 删除字段

```sql
ALTER TABLE 表名 DROP 字段名; 
```

- 修改表名

```sql
ALTER TABLE 表名 RENAME TO 新表名;
```

##### 4）删除

- 删除表

```sql
# 同数据库，删除后表中数据全部删除
DROP TABLE IF EXISTS 表名;
```

- 清空表

```sql
TRUNCATE TABLE 表名;
```

### （3）DML

#### 【1】添加数据（INSERT）

```sql
1. 指定添加的字段
INSERT INTO 表名 (字段名1, 字段名2, ...) VALUES (值1, 值2, ...);
2. 全部字段添加数据
INSERT INTO 表名 VALUES(值1, 值2, ...):
3. 批量添加数据
INSERT INTO 表名 (字段名1, 字段名2, ...) VALUES (值1, 值2, ...), (值1, 值2, ...);
INSERT INTO 表名 VALUES (值1, 值2, ...), (值1, 值2, ...);
# 注意：字段顺序与值一一对应，字符串和日期类型数据包含在''中，数据大小在字段规定范围
```

#### 【2】修改数据（UPDATE）

```sql
UPDATE 表名 SET 字段名1 = 值1, 字段名2 = 值2 ...{ WHERE 条件};
# eg:
update emp set name = '张三' where id = 1;
update emp set entrydate = '2022-1-1'; # 全局配置
# 注意：条件可有可无，可无即修改整张表所有数据
```

#### 【3】删除数据（DELETE）

```sql
DELETE FROM 表名 {WHERE 条件};
/*
注意： 条件可有可无，可无即删除整张表的所有数据
			不能删除某一字段的值，可UPDATE
*/
```

### （4）DQL

#### 【1】基本语法

```sql
SELECT 字段列表
FROM 表名
WHERE 条件列表
GROUP BY 分组字段列表
HAVING 分组后条件列表
ORDER BY 排序字段列表
LIMIT 分页参数;
```

#### 【2】基本查询

- 查询多个字段

```sql
SELECT 字段1, 字段2, 字段3 ... FROM 表名 ;
SELECT * FROM 表名 ; # 查询所有字段
```

- 字段设置别名

```sql
SELECT 字段1 [ AS 别名1 ] , 字段2 [ AS 别名2 ] ... FROM 表名;
SELECT 字段1 [ 别名1 ] , 字段2 [ 别名2 ] ... FROM 表名;
```

- 去除重复记录

```sql
SELECT DISTINCT 字段列表 FROM 表名;
```

#### 【3】条件查询

```sql
SELECT 字段列表 FROM 表名 WHERE 条件列表 ;
# 条件：
> 	>= 	<	 <=	 =	 <>[同!=] 
BETWEEN...AND... [含最小最大值] 
IN(...) 
LIKE 占位符 [模糊匹配，_匹配单个字符，%匹配任意个字符]
IS NULL  IS NOT NULL
AND[同&&] OR[同||] NOT[同!]

# eg:
#查询姓名为两个字的员工信息 _ %
select * from emp where name like '__';
#查询身份证号最后一位是X的员工信息
select * from emp where idcard like '%X';
select * from emp where idcard like '_________________X';
```

#### 【4】聚合函数

```sql
SELECT 聚合函数(字段名) FROM 表名;
# 聚合函数（NULL值不参与运算）
count max min avg sum
# eg:
select count(*) from emp; #count(*)，count(1)与count(字段)比较
# TODO：聚合函数的值只可与分组字段放在一起查询？
```

#### 【5】分组查询

- 语法

```sql
SELECT 字段列表 FROM 表名 [ WHERE 条件 ] GROUP BY 分组字段名 [ HAVING 分组后过滤条件 ];
# eg:
#查询年龄小于45的员工 , 并根据工作地址分组 , 获取员工数量大于等于3的工作地
select address, count(*) as address_account  from emp where age < 45 group by address having address_account >= 3;
#统计各个工作地址上班的男性及女性员工的数量
select address, gender, count(*) '数量' from emp group by address, gender;
```

- where与having区别
  - 执行时机：where在分组前过滤，having在分组后过滤
  - 判断条件：where不能对聚合函数进行判断，having可以
- 注意事项
  - 分组的查询字段为分组字段与聚合函数，其他字段无意义
  - 执行顺序：where，group，having
  - 支持多段分组：`group by columnA, columnB`

#### 【6】排序查询

```sql
SELECT 字段列表 FROM 表名 ORDER BY 字段1 排序方式1 , 字段2 排序方式2 ;
# 排序方式
ASC: 升序（默认，可不写） DESC: 降序
多字段排序，第一个字段值相等才按第二个字段排序
# eg:
#根据年龄对公司的员工进行升序排序 , 年龄相同 , 再按照入职时间进行降序排序
select * from emp order by age asc, entrydate desc;
```

#### 【7】分页查询

```sql
SELECT 字段列表 FROM 表名 LIMIT 起始索引, 查询记录数 ;
/*
	注意：起始索引 = （查询页码 - 1） * 每页记录数;
			  查询第一页：起始索引可忽略，limit x;
*/
# eg:
# 查询第一页，每页10条记录
select * from emp limit 10;
select * from emp limit 0, 10;
# 查询第二页，每页10条记录
select * from emp limit 10, 10; 
```

#### 【8】执行顺序

| 编写顺序                                                     | 执行顺序                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| SELECT 字段列表<br/>FROM 表名<br/>WHERE 条件列表<br/>GROUP BY 分组字段列表<br/>HAVING 分组后条件列表<br/>ORDER BY 排序字段列表<br/>LIMIT 分页参数; | FROM 表名<br/>WHERE 条件列表<br/>GROUP BY 分组字段列表<br/>HAVING 分组后条件列表<br/>SELECT 字段列表<br/>ORDER BY 排序字段列表<br/>LIMIT 分页参数 |

### （5）DCL

